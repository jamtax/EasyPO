<!DOCTYPE html>
<html lang="en-ZA">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Easy Quote | Easy Suite</title>
  <meta name="description" content="Professional quotation generator with VAT, discounts and PDF export.">

  <!-- Favicon -->
  <link rel="icon" href="icon.png" type="image/png">

  <!-- Tailwind -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">

  <style>
    @media print {
      nav, .no-print, button {
        display: none !important;
      }
      body {
        background: white;
      }
      .print-container {
        box-shadow: none !important;
        border: none !important;
      }
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen">

<!-- NAVIGATION -->
<nav class="bg-blue-600 text-white py-4 no-print">
  <div class="container mx-auto px-4 flex flex-wrap items-center gap-4">
    <a href="index.html" class="font-bold text-xl mr-4">Easy&nbsp;Suite</a>
    <a href="easy-quote.html" class="underline">Quote</a>
    <a href="easy-invoice.html">Invoice</a>
    <a href="easy-purchase-order.html">Purchase&nbsp;Order</a>
    <a href="easy-sales-order.html">Sales&nbsp;Order</a>
    <a href="easy-reciept.html">Receipt</a>
    <a href="easy-statement.html">Statement</a>
    <a href="easy-job-card.html">Job&nbsp;Card</a>
    <a href="easy-payroll.html">Payroll</a>
    <a href="easy-inventory.html">Inventory</a>
    <a href="easy-crm.html">CRM</a>
  </div>
</nav>

<main class="container mx-auto px-4 py-8">

<div class="bg-white p-8 rounded shadow print-container">

<!-- HEADER -->
<div class="flex flex-col md:flex-row justify-between items-start mb-6">

  <div>
    <input type="file" id="logoUpload" class="no-print mb-2">
    <img id="companyLogo" class="h-16 mb-2" />
    <h1 class="text-3xl font-bold text-gray-800">Quotation</h1>
    <p class="text-gray-600">Professional Quote Document</p>
  </div>

  <div class="text-right mt-4 md:mt-0">
    <p class="font-semibold">Quote No:</p>
    <p id="quoteNumber" class="text-lg font-bold text-blue-600"></p>

    <p class="mt-2 font-semibold">Date:</p>
    <input type="date" id="quoteDate" class="border px-2 py-1 rounded">

    <p class="mt-2 font-semibold">Currency:</p>
    <select id="currency" onchange="calculate()" class="border px-2 py-1 rounded">
      <option value="R">ZAR (R)</option>
      <option value="$">USD ($)</option>
      <option value="€">EUR (€)</option>
    </select>
  </div>
</div>

<!-- CLIENT SECTION -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
  <div>
    <h2 class="font-semibold mb-2">Client Information</h2>
    <input id="clientName" type="text" placeholder="Client Name" class="w-full border p-2 mb-2 rounded">
    <input id="clientCompany" type="text" placeholder="Company Name" class="w-full border p-2 mb-2 rounded">
    <input id="clientEmail" type="email" placeholder="Email" class="w-full border p-2 mb-2 rounded">
    <input id="clientPhone" type="text" placeholder="Phone" class="w-full border p-2 rounded">
  </div>

  <div>
    <h2 class="font-semibold mb-2">Terms & Notes</h2>
    <textarea id="terms" placeholder="Payment terms, validity, conditions..."
              class="w-full border p-2 rounded h-32"></textarea>
  </div>
</div>

<!-- ITEMS TABLE -->
<div class="overflow-x-auto">
<table class="w-full border text-sm">
<thead class="bg-gray-200">
<tr>
  <th class="p-2 border">Description</th>
  <th class="p-2 border w-20">Qty</th>
  <th class="p-2 border w-32">Unit</th>
  <th class="p-2 border w-24">Disc %</th>
  <th class="p-2 border w-32">Total</th>
  <th class="p-2 border no-print"></th>
</tr>
</thead>
<tbody id="itemsBody"></tbody>
</table>
</div>

<div class="mt-4 no-print">
  <button onclick="addRow()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
    + Add Item
  </button>
</div>

<!-- TOTALS -->
<div class="flex justify-end mt-8">
<div class="w-full md:w-1/3 text-sm">

<div class="flex justify-between mb-2">
  <span>Subtotal:</span>
  <span id="subtotal">R 0.00</span>
</div>

<div class="flex justify-between mb-2">
  <span>
    VAT %
    <input type="number" id="vatRate" value="15" min="0" class="w-16 border px-1 rounded" onchange="calculate()">
  </span>
  <span id="vat">R 0.00</span>
</div>

<div class="flex justify-between font-bold text-lg border-t pt-2">
  <span>Total:</span>
  <span id="grandTotal">R 0.00</span>
</div>

</div>
</div>

<!-- ACTIONS -->
<div class="mt-8 flex justify-between no-print">
  <button onclick="resetQuote()" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">
    Reset
  </button>

  <div class="space-x-4">
    <button onclick="saveDraft()" class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700">
      Save Draft
    </button>

    <button onclick="window.print()" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">
      Print / Save PDF
    </button>
  </div>
</div>

</div>
</main>

<script>

function generateQuoteNumber() {
  const now = new Date();
  return "Q-" + now.getFullYear() +
         String(now.getMonth()+1).padStart(2,'0') +
         String(now.getDate()).padStart(2,'0') +
         "-" + Math.floor(Math.random()*1000);
}

document.getElementById("quoteNumber").textContent = generateQuoteNumber();
document.getElementById("quoteDate").valueAsDate = new Date();

function addRow(description="", qty=1, unit=0, disc=0) {
  const tbody = document.getElementById("itemsBody");
  const row = document.createElement("tr");

  row.innerHTML = `
    <td class="border p-1">
      <input type="text" value="${description}" class="w-full p-1 border rounded desc">
    </td>
    <td class="border p-1">
      <input type="number" value="${qty}" class="w-full p-1 border rounded qty" oninput="calculate()">
    </td>
    <td class="border p-1">
      <input type="number" value="${unit}" class="w-full p-1 border rounded unit" oninput="calculate()">
    </td>
    <td class="border p-1">
      <input type="number" value="${disc}" class="w-full p-1 border rounded disc" oninput="calculate()">
    </td>
    <td class="border p-1 text-right total">0.00</td>
    <td class="border p-1 text-center no-print">
      <button onclick="this.closest('tr').remove(); calculate();" class="text-red-600 font-bold">×</button>
    </td>
  `;

  tbody.appendChild(row);
  calculate();
}

function calculate() {
  let subtotal = 0;
  const currency = document.getElementById("currency").value;
  const vatRate = parseFloat(document.getElementById("vatRate").value) || 0;

  document.querySelectorAll("#itemsBody tr").forEach(row => {
    const qty = parseFloat(row.querySelector(".qty").value) || 0;
    const unit = parseFloat(row.querySelector(".unit").value) || 0;
    const disc = parseFloat(row.querySelector(".disc").value) || 0;

    const lineTotal = qty * unit * (1 - disc/100);
    row.querySelector(".total").textContent = lineTotal.toFixed(2);
    subtotal += lineTotal;
  });

  const vat = subtotal * (vatRate/100);
  const total = subtotal + vat;

  document.getElementById("subtotal").textContent = currency + " " + subtotal.toFixed(2);
  document.getElementById("vat").textContent = currency + " " + vat.toFixed(2);
  document.getElementById("grandTotal").textContent = currency + " " + total.toFixed(2);
}

function saveDraft() {
  const data = document.querySelector("main").innerHTML;
  localStorage.setItem("easyQuoteDraft", data);
  alert("Draft Saved");
}

function resetQuote() {
  if(confirm("Clear this quote?")) {
    localStorage.removeItem("easyQuoteDraft");
    location.reload();
  }
}

window.onload = function() {
  const saved = localStorage.getItem("easyQuoteDraft");
  if(saved) {
    document.querySelector("main").innerHTML = saved;
  }
  addRow();
}

document.getElementById("logoUpload").addEventListener("change", function(e){
  const reader = new FileReader();
  reader.onload = function(){
    localStorage.setItem("logo", reader.result);
    document.getElementById("companyLogo").src = reader.result;
  }
  reader.readAsDataURL(e.target.files[0]);
});

const storedLogo = localStorage.getItem("logo");
if(storedLogo) document.getElementById("companyLogo").src = storedLogo;

</script>

</body>
</html>
